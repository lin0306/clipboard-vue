"use strict";var me=Object.defineProperty;var Ee=(i,e,t)=>e in i?me(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var f=(i,e,t)=>Ee(i,typeof e!="symbol"?e+"":e,t);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const m=require("electron"),k=require("node:url"),u=require("node:path"),E=require("node:fs"),ye=require("better-sqlite3"),N=require("path"),be=require("child_process"),j=require("os"),F=require("fs"),Se=require("util"),ne=require("events"),ve=require("http"),_e=require("https");var b=typeof document<"u"?document.currentScript:null;function Oe(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}const ie=F,R=N;var we={findAndReadPackageJson:Te,tryReadJsonAt:L};function Te(){return L(Ae())||L(Ne())||L(process.resourcesPath,"app.asar")||L(process.resourcesPath,"app")||L(process.cwd())||{name:void 0,version:void 0}}function L(...i){if(i[0])try{const e=R.join(...i),t=Le("package.json",e);if(!t)return;const r=JSON.parse(ie.readFileSync(t,"utf8")),n=(r==null?void 0:r.productName)||(r==null?void 0:r.name);return!n||n.toLowerCase()==="electron"?void 0:n?{name:n,version:r==null?void 0:r.version}:void 0}catch{return}}function Le(i,e){let t=e;for(;;){const r=R.parse(t),n=r.root,s=r.dir;if(ie.existsSync(R.join(t,i)))return R.resolve(R.join(t,i));if(t===n)return null;t=s}}function Ne(){const i=process.argv.filter(t=>t.indexOf("--user-data-dir=")===0);return i.length===0||typeof i[0]!="string"?null:i[0].replace("--user-data-dir=","")}function Ae(){var i;try{return(i=require.main)==null?void 0:i.filename}catch{return}}const Re=be,_=j,T=N,Ie=we;let De=class{constructor(){f(this,"appName");f(this,"appPackageJson");f(this,"platform",process.platform)}getAppLogPath(e=this.getAppName()){return this.platform==="darwin"?T.join(this.getSystemPathHome(),"Library/Logs",e):T.join(this.getAppUserDataPath(e),"logs")}getAppName(){var t;const e=this.appName||((t=this.getAppPackageJson())==null?void 0:t.name);if(!e)throw new Error("electron-log can't determine the app name. It tried these methods:\n1. Use `electron.app.name`\n2. Use productName or name from the nearest package.json`\nYou can also set it through log.transports.file.setAppName()");return e}getAppPackageJson(){return typeof this.appPackageJson!="object"&&(this.appPackageJson=Ie.findAndReadPackageJson()),this.appPackageJson}getAppUserDataPath(e=this.getAppName()){return e?T.join(this.getSystemPathAppData(),e):void 0}getAppVersion(){var e;return(e=this.getAppPackageJson())==null?void 0:e.version}getElectronLogPath(){return this.getAppLogPath()}getMacOsVersion(){const e=Number(_.release().split(".")[0]);return e<=19?`10.${e-4}`:e-9}getOsVersion(){let e=_.type().replace("_"," "),t=_.release();return e==="Darwin"&&(e="macOS",t=this.getMacOsVersion()),`${e} ${t}`}getPathVariables(){const e=this.getAppName(),t=this.getAppVersion(),r=this;return{appData:this.getSystemPathAppData(),appName:e,appVersion:t,get electronDefaultDir(){return r.getElectronLogPath()},home:this.getSystemPathHome(),libraryDefaultDir:this.getAppLogPath(e),libraryTemplate:this.getAppLogPath("{appName}"),temp:this.getSystemPathTemp(),userData:this.getAppUserDataPath(e)}}getSystemPathAppData(){const e=this.getSystemPathHome();switch(this.platform){case"darwin":return T.join(e,"Library/Application Support");case"win32":return process.env.APPDATA||T.join(e,"AppData/Roaming");default:return process.env.XDG_CONFIG_HOME||T.join(e,".config")}}getSystemPathHome(){var e;return((e=_.homedir)==null?void 0:e.call(_))||process.env.HOME}getSystemPathTemp(){return _.tmpdir()}getVersions(){return{app:`${this.getAppName()} ${this.getAppVersion()}`,electron:void 0,os:this.getOsVersion()}}isDev(){return process.env.NODE_ENV==="development"||process.env.ELECTRON_IS_DEV==="1"}isElectron(){return!!process.versions.electron}onAppEvent(e,t){}onAppReady(e){e()}onEveryWebContentsEvent(e,t){}onIpc(e,t){}onIpcInvoke(e,t){}openUrl(e,t=console.error){const n={darwin:"open",win32:"start",linux:"xdg-open"}[process.platform]||"xdg-open";Re.exec(`${n} ${e}`,{},s=>{s&&t(s)})}setAppName(e){this.appName=e}setPlatform(e){this.platform=e}setPreloadFileForSessions({filePath:e,includeFutureSession:t=!0,getSessions:r=()=>[]}){}sendIpc(e,t){}showErrorBox(e,t){}};var Fe=De;const Pe=N,$e=Fe;let Ce=class extends $e{constructor({electron:t}={}){super();f(this,"electron");this.electron=t}getAppName(){var r,n;let t;try{t=this.appName||((r=this.electron.app)==null?void 0:r.name)||((n=this.electron.app)==null?void 0:n.getName())}catch{}return t||super.getAppName()}getAppUserDataPath(t){return this.getPath("userData")||super.getAppUserDataPath(t)}getAppVersion(){var r;let t;try{t=(r=this.electron.app)==null?void 0:r.getVersion()}catch{}return t||super.getAppVersion()}getElectronLogPath(){return this.getPath("logs")||super.getElectronLogPath()}getPath(t){var r;try{return(r=this.electron.app)==null?void 0:r.getPath(t)}catch{return}}getVersions(){return{app:`${this.getAppName()} ${this.getAppVersion()}`,electron:`Electron ${process.versions.electron}`,os:this.getOsVersion()}}getSystemPathAppData(){return this.getPath("appData")||super.getSystemPathAppData()}isDev(){var t;return((t=this.electron.app)==null?void 0:t.isPackaged)!==void 0?!this.electron.app.isPackaged:typeof process.execPath=="string"?Pe.basename(process.execPath).toLowerCase().startsWith("electron"):super.isDev()}onAppEvent(t,r){var n;return(n=this.electron.app)==null||n.on(t,r),()=>{var s;(s=this.electron.app)==null||s.off(t,r)}}onAppReady(t){var r,n,s;(r=this.electron.app)!=null&&r.isReady()?t():(n=this.electron.app)!=null&&n.once?(s=this.electron.app)==null||s.once("ready",t):t()}onEveryWebContentsEvent(t,r){var s,o,a;return(o=(s=this.electron.webContents)==null?void 0:s.getAllWebContents())==null||o.forEach(c=>{c.on(t,r)}),(a=this.electron.app)==null||a.on("web-contents-created",n),()=>{var c,l;(c=this.electron.webContents)==null||c.getAllWebContents().forEach(p=>{p.off(t,r)}),(l=this.electron.app)==null||l.off("web-contents-created",n)};function n(c,l){l.on(t,r)}}onIpc(t,r){var n;(n=this.electron.ipcMain)==null||n.on(t,r)}onIpcInvoke(t,r){var n,s;(s=(n=this.electron.ipcMain)==null?void 0:n.handle)==null||s.call(n,t,r)}openUrl(t,r=console.error){var n;(n=this.electron.shell)==null||n.openExternal(t).catch(r)}setPreloadFileForSessions({filePath:t,includeFutureSession:r=!0,getSessions:n=()=>{var s;return[(s=this.electron.session)==null?void 0:s.defaultSession]}}){for(const o of n().filter(Boolean))s(o);r&&this.onAppEvent("session-created",o=>{s(o)});function s(o){typeof o.registerPreloadScript=="function"?o.registerPreloadScript({filePath:t,id:"electron-log-preload",type:"frame"}):o.setPreloads([...o.getPreloads(),t])}}sendIpc(t,r){var n,s;(s=(n=this.electron.BrowserWindow)==null?void 0:n.getAllWindows())==null||s.forEach(o=>{var a,c;((a=o.webContents)==null?void 0:a.isDestroyed())===!1&&((c=o.webContents)==null?void 0:c.isCrashed())===!1&&o.webContents.send(t,r)})}showErrorBox(t,r){var n;(n=this.electron.dialog)==null||n.showErrorBox(t,r)}};var xe=Ce,se={exports:{}};(function(i){let e={};try{e=require("electron")}catch{}e.ipcRenderer&&t(e),i.exports=t;function t({contextBridge:r,ipcRenderer:n}){if(!n)return;n.on("__ELECTRON_LOG_IPC__",(o,a)=>{window.postMessage({cmd:"message",...a})}),n.invoke("__ELECTRON_LOG__",{cmd:"getOptions"}).catch(o=>console.error(new Error(`electron-log isn't initialized in the main process. Please call log.initialize() before. ${o.message}`)));const s={sendToMain(o){try{n.send("__ELECTRON_LOG__",o)}catch(a){console.error("electronLog.sendToMain ",a,"data:",o),n.send("__ELECTRON_LOG__",{cmd:"errorHandler",error:{message:a==null?void 0:a.message,stack:a==null?void 0:a.stack},errorName:"sendToMain"})}},log(...o){s.sendToMain({data:o,level:"info"})}};for(const o of["error","warn","info","verbose","debug","silly"])s[o]=(...a)=>s.sendToMain({data:a,level:o});if(r&&process.contextIsolated)try{r.exposeInMainWorld("__electronLog",s)}catch{}typeof window=="object"?window.__electronLog=s:__electronLog=s}})(se);var je=se.exports;const J=F,Me=j,G=N,Ue=je;var We={initialize({externalApi:i,getSessions:e,includeFutureSession:t,logger:r,preload:n=!0,spyRendererConsole:s=!1}){i.onAppReady(()=>{try{n&&ke({externalApi:i,getSessions:e,includeFutureSession:t,preloadOption:n}),s&&ze({externalApi:i,logger:r})}catch(o){r.warn(o)}})}};function ke({externalApi:i,getSessions:e,includeFutureSession:t,preloadOption:r}){let n=typeof r=="string"?r:void 0;try{n=G.resolve(__dirname,"../renderer/electron-log-preload.js")}catch{}if(!n||!J.existsSync(n)){n=G.join(i.getAppUserDataPath()||Me.tmpdir(),"electron-log-preload.js");const s=`
      try {
        (${Ue.toString()})(require('electron'));
      } catch(e) {
        console.error(e);
      }
    `;J.writeFileSync(n,s,"utf8")}i.setPreloadFileForSessions({filePath:n,includeFutureSession:t,getSessions:e})}function ze({externalApi:i,logger:e}){const t=["verbose","info","warning","error"];i.onEveryWebContentsEvent("console-message",(r,n,s)=>{e.processMessage({data:[s],level:t[n],variables:{processType:"renderer"}})})}var Ve=qe;function qe(i){return Object.defineProperties(e,{defaultLabel:{value:"",writable:!0},labelPadding:{value:!0,writable:!0},maxLabelLength:{value:0,writable:!0},labelLength:{get(){switch(typeof e.labelPadding){case"boolean":return e.labelPadding?e.maxLabelLength:0;case"number":return e.labelPadding;default:return 0}}}});function e(t){e.maxLabelLength=Math.max(e.maxLabelLength,t.length);const r={};for(const n of i.levels)r[n]=(...s)=>i.logData(s,{level:n,scope:t});return r.log=r.info,r}}let Be=class{constructor({processMessage:e}){this.processMessage=e,this.buffer=[],this.enabled=!1,this.begin=this.begin.bind(this),this.commit=this.commit.bind(this),this.reject=this.reject.bind(this)}addMessage(e){this.buffer.push(e)}begin(){this.enabled=[]}commit(){this.enabled=!1,this.buffer.forEach(e=>this.processMessage(e)),this.buffer=[]}reject(){this.enabled=!1,this.buffer=[]}};var He=Be;const Je=Ve,Ge=He;var v;let Ye=(v=class{constructor({allowUnknownLevel:e=!1,dependencies:t={},errorHandler:r,eventLogger:n,initializeFn:s,isDev:o=!1,levels:a=["error","warn","info","verbose","debug","silly"],logId:c,transportFactories:l={},variables:p}={}){f(this,"dependencies",{});f(this,"errorHandler",null);f(this,"eventLogger",null);f(this,"functions",{});f(this,"hooks",[]);f(this,"isDev",!1);f(this,"levels",null);f(this,"logId",null);f(this,"scope",null);f(this,"transports",{});f(this,"variables",{});this.addLevel=this.addLevel.bind(this),this.create=this.create.bind(this),this.initialize=this.initialize.bind(this),this.logData=this.logData.bind(this),this.processMessage=this.processMessage.bind(this),this.allowUnknownLevel=e,this.buffering=new Ge(this),this.dependencies=t,this.initializeFn=s,this.isDev=o,this.levels=a,this.logId=c,this.scope=Je(this),this.transportFactories=l,this.variables=p||{};for(const g of this.levels)this.addLevel(g,!1);this.log=this.info,this.functions.log=this.log,this.errorHandler=r,r==null||r.setOptions({...t,logFn:this.error}),this.eventLogger=n,n==null||n.setOptions({...t,logger:this});for(const[g,y]of Object.entries(l))this.transports[g]=y(this,t);v.instances[c]=this}static getInstance({logId:e}){return this.instances[e]||this.instances.default}addLevel(e,t=this.levels.length){t!==!1&&this.levels.splice(t,0,e),this[e]=(...r)=>this.logData(r,{level:e}),this.functions[e]=this[e]}catchErrors(e){return this.processMessage({data:["log.catchErrors is deprecated. Use log.errorHandler instead"],level:"warn"},{transports:["console"]}),this.errorHandler.startCatching(e)}create(e){return typeof e=="string"&&(e={logId:e}),new v({dependencies:this.dependencies,errorHandler:this.errorHandler,initializeFn:this.initializeFn,isDev:this.isDev,transportFactories:this.transportFactories,variables:{...this.variables},...e})}compareLevels(e,t,r=this.levels){const n=r.indexOf(e),s=r.indexOf(t);return s===-1||n===-1?!0:s<=n}initialize(e={}){this.initializeFn({logger:this,...this.dependencies,...e})}logData(e,t={}){this.buffering.enabled?this.buffering.addMessage({data:e,...t}):this.processMessage({data:e,...t})}processMessage(e,{transports:t=this.transports}={}){if(e.cmd==="errorHandler"){this.errorHandler.handle(e.error,{errorName:e.errorName,processType:"renderer",showDialog:!!e.showDialog});return}let r=e.level;this.allowUnknownLevel||(r=this.levels.includes(e.level)?e.level:"info");const n={date:new Date,logId:this.logId,...e,level:r,variables:{...this.variables,...e.variables}};for(const[s,o]of this.transportEntries(t))if(!(typeof o!="function"||o.level===!1)&&this.compareLevels(o.level,e.level))try{const a=this.hooks.reduce((c,l)=>c&&l(c,o,s),n);a&&o({...a,data:[...a.data]})}catch(a){this.processInternalErrorFn(a)}}processInternalErrorFn(e){}transportEntries(e=this.transports){return(Array.isArray(e)?e:Object.entries(e)).map(r=>{switch(typeof r){case"string":return this.transports[r]?[r,this.transports[r]]:null;case"function":return[r.name,r];default:return Array.isArray(r)?r:null}}).filter(Boolean)}},f(v,"instances",{}),v);var Xe=Ye;let Ke=class{constructor({externalApi:e,logFn:t=void 0,onError:r=void 0,showDialog:n=void 0}={}){f(this,"externalApi");f(this,"isActive",!1);f(this,"logFn");f(this,"onError");f(this,"showDialog",!0);this.createIssue=this.createIssue.bind(this),this.handleError=this.handleError.bind(this),this.handleRejection=this.handleRejection.bind(this),this.setOptions({externalApi:e,logFn:t,onError:r,showDialog:n}),this.startCatching=this.startCatching.bind(this),this.stopCatching=this.stopCatching.bind(this)}handle(e,{logFn:t=this.logFn,onError:r=this.onError,processType:n="browser",showDialog:s=this.showDialog,errorName:o=""}={}){var a;e=Qe(e);try{if(typeof r=="function"){const c=((a=this.externalApi)==null?void 0:a.getVersions())||{},l=this.createIssue;if(r({createIssue:l,error:e,errorName:o,processType:n,versions:c})===!1)return}o?t(o,e):t(e),s&&!o.includes("rejection")&&this.externalApi&&this.externalApi.showErrorBox(`A JavaScript error occurred in the ${n} process`,e.stack)}catch{console.error(e)}}setOptions({externalApi:e,logFn:t,onError:r,showDialog:n}){typeof e=="object"&&(this.externalApi=e),typeof t=="function"&&(this.logFn=t),typeof r=="function"&&(this.onError=r),typeof n=="boolean"&&(this.showDialog=n)}startCatching({onError:e,showDialog:t}={}){this.isActive||(this.isActive=!0,this.setOptions({onError:e,showDialog:t}),process.on("uncaughtException",this.handleError),process.on("unhandledRejection",this.handleRejection))}stopCatching(){this.isActive=!1,process.removeListener("uncaughtException",this.handleError),process.removeListener("unhandledRejection",this.handleRejection)}createIssue(e,t){var r;(r=this.externalApi)==null||r.openUrl(`${e}?${new URLSearchParams(t).toString()}`)}handleError(e){this.handle(e,{errorName:"Unhandled"})}handleRejection(e){const t=e instanceof Error?e:new Error(JSON.stringify(e));this.handle(t,{errorName:"Unhandled rejection"})}};function Qe(i){if(i instanceof Error)return i;if(i&&typeof i=="object"){if(i.message)return Object.assign(new Error(i.message),i);try{return new Error(JSON.stringify(i))}catch(e){return new Error(`Couldn't normalize error ${String(i)}: ${e}`)}}return new Error(`Can't normalize error ${String(i)}`)}var Ze=Ke;let et=class{constructor(e={}){f(this,"disposers",[]);f(this,"format","{eventSource}#{eventName}:");f(this,"formatters",{app:{"certificate-error":({args:e})=>this.arrayToObject(e.slice(1,4),["url","error","certificate"]),"child-process-gone":({args:e})=>e.length===1?e[0]:e,"render-process-gone":({args:[e,t]})=>t&&typeof t=="object"?{...t,...this.getWebContentsDetails(e)}:[]},webContents:{"console-message":({args:[e,t,r,n]})=>{if(!(e<3))return{message:t,source:`${n}:${r}`}},"did-fail-load":({args:e})=>this.arrayToObject(e,["errorCode","errorDescription","validatedURL","isMainFrame","frameProcessId","frameRoutingId"]),"did-fail-provisional-load":({args:e})=>this.arrayToObject(e,["errorCode","errorDescription","validatedURL","isMainFrame","frameProcessId","frameRoutingId"]),"plugin-crashed":({args:e})=>this.arrayToObject(e,["name","version"]),"preload-error":({args:e})=>this.arrayToObject(e,["preloadPath","error"])}});f(this,"events",{app:{"certificate-error":!0,"child-process-gone":!0,"render-process-gone":!0},webContents:{"did-fail-load":!0,"did-fail-provisional-load":!0,"plugin-crashed":!0,"preload-error":!0,unresponsive:!0}});f(this,"externalApi");f(this,"level","error");f(this,"scope","");this.setOptions(e)}setOptions({events:e,externalApi:t,level:r,logger:n,format:s,formatters:o,scope:a}){typeof e=="object"&&(this.events=e),typeof t=="object"&&(this.externalApi=t),typeof r=="string"&&(this.level=r),typeof n=="object"&&(this.logger=n),(typeof s=="string"||typeof s=="function")&&(this.format=s),typeof o=="object"&&(this.formatters=o),typeof a=="string"&&(this.scope=a)}startLogging(e={}){this.setOptions(e),this.disposeListeners();for(const t of this.getEventNames(this.events.app))this.disposers.push(this.externalApi.onAppEvent(t,(...r)=>{this.handleEvent({eventSource:"app",eventName:t,handlerArgs:r})}));for(const t of this.getEventNames(this.events.webContents))this.disposers.push(this.externalApi.onEveryWebContentsEvent(t,(...r)=>{this.handleEvent({eventSource:"webContents",eventName:t,handlerArgs:r})}))}stopLogging(){this.disposeListeners()}arrayToObject(e,t){const r={};return t.forEach((n,s)=>{r[n]=e[s]}),e.length>t.length&&(r.unknownArgs=e.slice(t.length)),r}disposeListeners(){this.disposers.forEach(e=>e()),this.disposers=[]}formatEventLog({eventName:e,eventSource:t,handlerArgs:r}){var p;const[n,...s]=r;if(typeof this.format=="function")return this.format({args:s,event:n,eventName:e,eventSource:t});const o=(p=this.formatters[t])==null?void 0:p[e];let a=s;if(typeof o=="function"&&(a=o({args:s,event:n,eventName:e,eventSource:t})),!a)return;const c={};return Array.isArray(a)?c.args=a:typeof a=="object"&&Object.assign(c,a),t==="webContents"&&Object.assign(c,this.getWebContentsDetails(n==null?void 0:n.sender)),[this.format.replace("{eventSource}",t==="app"?"App":"WebContents").replace("{eventName}",e),c]}getEventNames(e){return!e||typeof e!="object"?[]:Object.entries(e).filter(([t,r])=>r).map(([t])=>t)}getWebContentsDetails(e){if(!(e!=null&&e.loadURL))return{};try{return{webContents:{id:e.id,url:e.getURL()}}}catch{return{}}}handleEvent({eventName:e,eventSource:t,handlerArgs:r}){var s;const n=this.formatEventLog({eventName:e,eventSource:t,handlerArgs:r});if(n){const o=this.scope?this.logger.scope(this.scope):this.logger;(s=o==null?void 0:o[this.level])==null||s.call(o,...n)}}};var tt=et,P={transform:rt};function rt({logger:i,message:e,transport:t,initialData:r=(e==null?void 0:e.data)||[],transforms:n=t==null?void 0:t.transforms}){return n.reduce((s,o)=>typeof o=="function"?o({data:s,logger:i,message:e,transport:t}):s,r)}const{transform:nt}=P;var oe={concatFirstStringElements:it,format({message:i,logger:e,transport:t,data:r=i==null?void 0:i.data}){switch(typeof t.format){case"string":return nt({message:i,logger:e,transforms:[at,ot,ct],transport:t,initialData:[t.format,...r]});case"function":return t.format({data:r,level:(i==null?void 0:i.level)||"info",logger:e,message:i,transport:t});default:return r}}};function it({data:i}){return typeof i[0]!="string"||typeof i[1]!="string"||i[0].match(/%[1cdfiOos]/)?i:[`${i[0]} ${i[1]}`,...i.slice(2)]}function st(i){const e=Math.abs(i),t=i>0?"-":"+",r=Math.floor(e/60).toString().padStart(2,"0"),n=(e%60).toString().padStart(2,"0");return`${t}${r}:${n}`}function ot({data:i,logger:e,message:t}){const{defaultLabel:r,labelLength:n}=(e==null?void 0:e.scope)||{},s=i[0];let o=t.scope;o||(o=r);let a;return o===""?a=n>0?"".padEnd(n+3):"":typeof o=="string"?a=` (${o})`.padEnd(n+3):a="",i[0]=s.replace("{scope}",a),i}function at({data:i,message:e}){let t=i[0];if(typeof t!="string")return i;t=t.replace("{level}]",`${e.level}]`.padEnd(6," "));const r=e.date||new Date;return i[0]=t.replace(/\{(\w+)}/g,(n,s)=>{var o;switch(s){case"level":return e.level||"info";case"logId":return e.logId;case"y":return r.getFullYear().toString(10);case"m":return(r.getMonth()+1).toString(10).padStart(2,"0");case"d":return r.getDate().toString(10).padStart(2,"0");case"h":return r.getHours().toString(10).padStart(2,"0");case"i":return r.getMinutes().toString(10).padStart(2,"0");case"s":return r.getSeconds().toString(10).padStart(2,"0");case"ms":return r.getMilliseconds().toString(10).padStart(3,"0");case"z":return st(r.getTimezoneOffset());case"iso":return r.toISOString();default:return((o=e.variables)==null?void 0:o[s])||n}}).trim(),i}function ct({data:i}){const e=i[0];if(typeof e!="string")return i;if(e.lastIndexOf("{text}")===e.length-6)return i[0]=e.replace(/\s?{text}/,""),i[0]===""&&i.shift(),i;const r=e.split("{text}");let n=[];return r[0]!==""&&n.push(r[0]),n=n.concat(i.slice(1)),r[1]!==""&&n.push(r[1]),n}var ae={exports:{}};(function(i){const e=Se;i.exports={serialize:r,maxDepth({data:n,transport:s,depth:o=(s==null?void 0:s.depth)??6}){if(!n)return n;if(o<1)return Array.isArray(n)?"[array]":typeof n=="object"&&n?"[object]":n;if(Array.isArray(n))return n.map(c=>i.exports.maxDepth({data:c,depth:o-1}));if(typeof n!="object"||n&&typeof n.toISOString=="function")return n;if(n===null)return null;if(n instanceof Error)return n;const a={};for(const c in n)Object.prototype.hasOwnProperty.call(n,c)&&(a[c]=i.exports.maxDepth({data:n[c],depth:o-1}));return a},toJSON({data:n}){return JSON.parse(JSON.stringify(n,t()))},toString({data:n,transport:s}){const o=(s==null?void 0:s.inspectOptions)||{},a=n.map(c=>{if(c!==void 0)try{const l=JSON.stringify(c,t(),"  ");return l===void 0?void 0:JSON.parse(l)}catch{return c}});return e.formatWithOptions(o,...a)}};function t(n={}){const s=new WeakSet;return function(o,a){if(typeof a=="object"&&a!==null){if(s.has(a))return;s.add(a)}return r(o,a,n)}}function r(n,s,o={}){const a=(o==null?void 0:o.serializeMapAndSet)!==!1;return s instanceof Error?s.stack:s&&(typeof s=="function"?`[function] ${s.toString()}`:s instanceof Date?s.toISOString():a&&s instanceof Map&&Object.fromEntries?Object.fromEntries(s):a&&s instanceof Set&&Array.from?Array.from(s):s)}})(ae);var M=ae.exports,z={applyAnsiStyles({data:i}){return Y(i,lt,pt)},removeStyles({data:i}){return Y(i,()=>"")}};const ce={unset:"\x1B[0m",black:"\x1B[30m",red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m",cyan:"\x1B[36m",white:"\x1B[37m"};function lt(i){const e=i.replace(/color:\s*(\w+).*/,"$1").toLowerCase();return ce[e]||""}function pt(i){return i+ce.unset}function Y(i,e,t){const r={};return i.reduce((n,s,o,a)=>{if(r[o])return n;if(typeof s=="string"){let c=o,l=!1;s=s.replace(/%[1cdfiOos]/g,p=>{if(c+=1,p!=="%c")return p;const g=a[c];return typeof g=="string"?(r[c]=!0,l=!0,e(g,s)):p}),l&&t&&(s=t(s))}return n.push(s),n},[])}const{concatFirstStringElements:ft,format:ht}=oe,{maxDepth:dt,toJSON:ut}=M,{applyAnsiStyles:gt,removeStyles:mt}=z,{transform:Et}=P,X={error:console.error,warn:console.warn,info:console.info,verbose:console.info,debug:console.debug,silly:console.debug,log:console.log};var yt=le;const bt=process.platform==="win32"?">":"›",V=`%c{h}:{i}:{s}.{ms}{scope}%c ${bt} {text}`;Object.assign(le,{DEFAULT_FORMAT:V});function le(i){return Object.assign(e,{format:V,level:"silly",transforms:[St,ht,_t,ft,dt,ut],useStyles:process.env.FORCE_STYLES,writeFn({message:t}){(X[t.level]||X.info)(...t.data)}});function e(t){const r=Et({logger:i,message:t,transport:e});e.writeFn({message:{...t,data:r}})}}function St({data:i,message:e,transport:t}){return t.format!==V?i:[`color:${Ot(e.level)}`,"color:unset",...i]}function vt(i,e){if(typeof i=="boolean")return i;const r=e==="error"||e==="warn"?process.stderr:process.stdout;return r&&r.isTTY}function _t(i){const{message:e,transport:t}=i;return(vt(t.useStyles,e.level)?gt:mt)(i)}function Ot(i){const e={error:"red",warn:"yellow",info:"cyan",default:"unset"};return e[i]||e.default}const wt=ne,S=F,K=j;let Tt=class extends wt{constructor({path:t,writeOptions:r={encoding:"utf8",flag:"a",mode:438},writeAsync:n=!1}){super();f(this,"asyncWriteQueue",[]);f(this,"bytesWritten",0);f(this,"hasActiveAsyncWriting",!1);f(this,"path",null);f(this,"initialSize");f(this,"writeOptions",null);f(this,"writeAsync",!1);this.path=t,this.writeOptions=r,this.writeAsync=n}get size(){return this.getSize()}clear(){try{return S.writeFileSync(this.path,"",{mode:this.writeOptions.mode,flag:"w"}),this.reset(),!0}catch(t){return t.code==="ENOENT"?!0:(this.emit("error",t,this),!1)}}crop(t){try{const r=Lt(this.path,t||4096);this.clear(),this.writeLine(`[log cropped]${K.EOL}${r}`)}catch(r){this.emit("error",new Error(`Couldn't crop file ${this.path}. ${r.message}`),this)}}getSize(){if(this.initialSize===void 0)try{const t=S.statSync(this.path);this.initialSize=t.size}catch{this.initialSize=0}return this.initialSize+this.bytesWritten}increaseBytesWrittenCounter(t){this.bytesWritten+=Buffer.byteLength(t,this.writeOptions.encoding)}isNull(){return!1}nextAsyncWrite(){const t=this;if(this.hasActiveAsyncWriting||this.asyncWriteQueue.length===0)return;const r=this.asyncWriteQueue.join("");this.asyncWriteQueue=[],this.hasActiveAsyncWriting=!0,S.writeFile(this.path,r,this.writeOptions,n=>{t.hasActiveAsyncWriting=!1,n?t.emit("error",new Error(`Couldn't write to ${t.path}. ${n.message}`),this):t.increaseBytesWrittenCounter(r),t.nextAsyncWrite()})}reset(){this.initialSize=void 0,this.bytesWritten=0}toString(){return this.path}writeLine(t){if(t+=K.EOL,this.writeAsync){this.asyncWriteQueue.push(t),this.nextAsyncWrite();return}try{S.writeFileSync(this.path,t,this.writeOptions),this.increaseBytesWrittenCounter(t)}catch(r){this.emit("error",new Error(`Couldn't write to ${this.path}. ${r.message}`),this)}}};var pe=Tt;function Lt(i,e){const t=Buffer.alloc(e),r=S.statSync(i),n=Math.min(r.size,e),s=Math.max(0,r.size-e),o=S.openSync(i,"r"),a=S.readSync(o,t,0,n,s);return S.closeSync(o),t.toString("utf8",0,a)}const Nt=pe;let At=class extends Nt{clear(){}crop(){}getSize(){return 0}isNull(){return!0}writeLine(){}};var Rt=At;const It=ne,Q=F,Z=N,Dt=pe,Ft=Rt;let Pt=class extends It{constructor(){super();f(this,"store",{});this.emitError=this.emitError.bind(this)}provide({filePath:t,writeOptions:r={},writeAsync:n=!1}){let s;try{if(t=Z.resolve(t),this.store[t])return this.store[t];s=this.createFile({filePath:t,writeOptions:r,writeAsync:n})}catch(o){s=new Ft({path:t}),this.emitError(o,s)}return s.on("error",this.emitError),this.store[t]=s,s}createFile({filePath:t,writeOptions:r,writeAsync:n}){return this.testFileWriting({filePath:t,writeOptions:r}),new Dt({path:t,writeOptions:r,writeAsync:n})}emitError(t,r){this.emit("error",t,r)}testFileWriting({filePath:t,writeOptions:r}){Q.mkdirSync(Z.dirname(t),{recursive:!0}),Q.writeFileSync(t,"",{flag:"a",mode:r.mode})}};var $t=Pt;const $=F,Ct=j,A=N,xt=$t,{transform:jt}=P,{removeStyles:Mt}=z,{format:Ut,concatFirstStringElements:Wt}=oe,{toString:kt}=M;var zt=qt;const Vt=new xt;function qt(i,{registry:e=Vt,externalApi:t}={}){let r;return e.listenerCount("error")<1&&e.on("error",(l,p)=>{o(`Can't write to ${p}`,l)}),Object.assign(n,{fileName:Bt(i.variables.processType),format:"[{y}-{m}-{d} {h}:{i}:{s}.{ms}] [{level}]{scope} {text}",getFile:a,inspectOptions:{depth:5},level:"silly",maxSize:1024**2,readAllLogs:c,sync:!0,transforms:[Mt,Ut,Wt,kt],writeOptions:{flag:"a",mode:438,encoding:"utf8"},archiveLogFn(l){const p=l.toString(),g=A.parse(p);try{$.renameSync(p,A.join(g.dir,`${g.name}.old${g.ext}`))}catch(y){o("Could not rotate log",y);const ge=Math.round(n.maxSize/4);l.crop(Math.min(ge,256*1024))}},resolvePathFn(l){return A.join(l.libraryDefaultDir,l.fileName)},setAppName(l){i.dependencies.externalApi.setAppName(l)}});function n(l){const p=a(l);n.maxSize>0&&p.size>n.maxSize&&(n.archiveLogFn(p),p.reset());const y=jt({logger:i,message:l,transport:n});p.writeLine(y)}function s(){r||(r=Object.create(Object.prototype,{...Object.getOwnPropertyDescriptors(t.getPathVariables()),fileName:{get(){return n.fileName},enumerable:!0}}),typeof n.archiveLog=="function"&&(n.archiveLogFn=n.archiveLog,o("archiveLog is deprecated. Use archiveLogFn instead")),typeof n.resolvePath=="function"&&(n.resolvePathFn=n.resolvePath,o("resolvePath is deprecated. Use resolvePathFn instead")))}function o(l,p=null,g="error"){const y=[`electron-log.transports.file: ${l}`];p&&y.push(p),i.transports.console({data:y,date:new Date,level:g})}function a(l){s();const p=n.resolvePathFn(r,l);return e.provide({filePath:p,writeAsync:!n.sync,writeOptions:n.writeOptions})}function c({fileFilter:l=p=>p.endsWith(".log")}={}){s();const p=A.dirname(n.resolvePathFn(r));return $.existsSync(p)?$.readdirSync(p).map(g=>A.join(p,g)).filter(l).map(g=>{try{return{path:g,lines:$.readFileSync(g,"utf8").split(Ct.EOL)}}catch{return null}}).filter(Boolean):[]}}function Bt(i=process.type){switch(i){case"renderer":return"renderer.log";case"worker":return"worker.log";default:return"main.log"}}const{maxDepth:Ht,toJSON:Jt}=M,{transform:Gt}=P;var Yt=Xt;function Xt(i,{externalApi:e}){return Object.assign(t,{depth:3,eventId:"__ELECTRON_LOG_IPC__",level:i.isDev?"silly":!1,transforms:[Jt,Ht]}),e!=null&&e.isElectron()?t:void 0;function t(r){var n;((n=r==null?void 0:r.variables)==null?void 0:n.processType)!=="renderer"&&(e==null||e.sendIpc(t.eventId,{...r,data:Gt({logger:i,message:r,transport:t})}))}}const Kt=ve,Qt=_e,{transform:Zt}=P,{removeStyles:er}=z,{toJSON:tr,maxDepth:rr}=M;var nr=ir;function ir(i){return Object.assign(e,{client:{name:"electron-application"},depth:6,level:!1,requestOptions:{},transforms:[er,tr,rr],makeBodyFn({message:t}){return JSON.stringify({client:e.client,data:t.data,date:t.date.getTime(),level:t.level,scope:t.scope,variables:t.variables})},processErrorFn({error:t}){i.processMessage({data:[`electron-log: can't POST ${e.url}`,t],level:"warn"},{transports:["console","file"]})},sendRequestFn({serverUrl:t,requestOptions:r,body:n}){const o=(t.startsWith("https:")?Qt:Kt).request(t,{method:"POST",...r,headers:{"Content-Type":"application/json","Content-Length":n.length,...r.headers}});return o.write(n),o.end(),o}});function e(t){if(!e.url)return;const r=e.makeBodyFn({logger:i,message:{...t,data:Zt({logger:i,message:t,transport:e})},transport:e}),n=e.sendRequestFn({serverUrl:e.url,requestOptions:e.requestOptions,body:Buffer.from(r,"utf8")});n.on("error",s=>e.processErrorFn({error:s,logger:i,message:t,request:n,transport:e}))}}const ee=Xe,sr=Ze,or=tt,ar=yt,cr=zt,lr=Yt,pr=nr;var fr=hr;function hr({dependencies:i,initializeFn:e}){var r;const t=new ee({dependencies:i,errorHandler:new sr,eventLogger:new or,initializeFn:e,isDev:(r=i.externalApi)==null?void 0:r.isDev(),logId:"default",transportFactories:{console:ar,file:cr,ipc:lr,remote:pr},variables:{processType:"main"}});return t.default=t,t.Logger=ee,t.processInternalErrorFn=n=>{t.transports.console.writeFn({message:{data:["Unhandled electron-log error",n],level:"error"}})},t}const dr=m,ur=xe,{initialize:gr}=We,mr=fr,q=new ur({electron:dr}),U=mr({dependencies:{externalApi:q},initializeFn:gr});var Er=U;q.onIpc("__ELECTRON_LOG__",(i,e)=>{e.scope&&U.Logger.getInstance(e).scope(e.scope);const t=new Date(e.date);fe({...e,date:t.getTime()?t:new Date})});q.onIpcInvoke("__ELECTRON_LOG__",(i,{cmd:e="",logId:t})=>{switch(e){case"getOptions":return{levels:U.Logger.getInstance({logId:t}).levels,logId:t};default:return fe({data:[`Unknown cmd '${e}'`],level:"error"}),{}}});function fe(i){var e;(e=U.Logger.getInstance(i))==null||e.processMessage(i)}const yr=Er;var br=yr;const h=Oe(br);h.initialize();let I=u.dirname(k.fileURLToPath(typeof document>"u"?require("url").pathToFileURL(__filename).href:b&&b.tagName.toUpperCase()==="SCRIPT"&&b.src||new URL("main.js",document.baseURI).href));const he=process.env.NODE_ENV;he!=="development"&&(I=I.replace("\\app.asar\\dist-electron",""));const O=class O{constructor(){f(this,"db");const e=u.join(I,"../data");h.info("[数据库进程] 数据文件存储文件夹位置：",e),E.existsSync(e)||E.mkdirSync(e);const t=u.join(e,"clipboard.db");h.info("[数据库进程] 数据文件存储位置：",t),this.db=new ye(t),this.initTables()}static getInstance(){return O.instance||(O.instance=new O),O.instance}initTables(){this.db.exec(`
                    CREATE TABLE IF NOT EXISTS clipboard_items (
                        id INTEGER PRIMARY KEY AUTOINCREMENT,
                        content TEXT NOT NULL,
                        copy_time INTEGER NOT NULL,
                        is_topped BOOLEAN DEFAULT 0,
                        top_time INTEGER,
                        type TEXT DEFAULT 'text',
                        file_path TEXT
                    )
                `),this.db.exec(`
                    CREATE TABLE IF NOT EXISTS tags (
                        id INTEGER PRIMARY KEY AUTOINCREMENT,
                        name TEXT NOT NULL UNIQUE,
                        created_at INTEGER NOT NULL
                    )
                `),this.db.exec(`
                    CREATE TABLE IF NOT EXISTS item_tags (
                        item_id INTEGER,
                        tag_id INTEGER,
                        FOREIGN KEY (item_id) REFERENCES clipboard_items (id) ON DELETE CASCADE,
                        FOREIGN KEY (tag_id) REFERENCES tags (id) ON DELETE CASCADE,
                        PRIMARY KEY (item_id, tag_id)
                    )
                `)}close(){this.db.close()}addItem(e,t="text",r=null){this.db.transaction(()=>{try{let n=Date.now();if(t==="text")this.db.prepare("DELETE FROM clipboard_items WHERE content = ? AND type = ?").run(e,t);else if(t==="image"&&r){const s=this.db.prepare("SELECT copy_time FROM clipboard_items WHERE type = ? AND file_path = ?").get("image",r);s&&(n=s.copy_time),this.db.prepare("DELETE FROM clipboard_items WHERE type = ? AND file_path = ?").run("image",r)}this.db.prepare("INSERT INTO clipboard_items (content, copy_time, type, file_path) VALUES (?, ?, ?, ?)").run(e,n,t,r)}catch(n){throw n}})}getAllItems(){return this.db.prepare("SELECT * FROM clipboard_items ORDER BY is_topped DESC, CASE WHEN is_topped = 1 THEN top_time ELSE copy_time END DESC").all()}getItemsByTag(e){return this.db.prepare("SELECT ci.* FROM clipboard_items ci INNER JOIN item_tags it ON ci.id = it.item_id INNER JOIN tags t ON it.tag_id = t.id WHERE t.name = ? ORDER BY ci.is_topped DESC, CASE WHEN ci.is_topped = 1 THEN ci.top_time ELSE ci.copy_time END DESC").all(e)}deleteItem(e){try{const t=this.db.prepare("SELECT type, file_path FROM clipboard_items WHERE id = ?").get(e);if(t&&t.type==="image"&&t.file_path)try{E.unlinkSync(t.file_path)}catch(r){console.error("删除临时图片文件失败:",r)}this.db.prepare("SELECT type, file_path FROM clipboard_items WHERE id = ?").run(e)}catch(t){throw t}}clearAll(){return new Promise(async(e,t)=>{try{let r;he==="development"?r=u.join(I,"../config"):r=u.join(I,"./config"),h.info("[数据库进程] 配置文件目录:",r);const n=u.join(r,"settings.conf");h.info("[数据库进程] 配置文件路径:",n);const s=JSON.parse(E.readFileSync(n,"utf8"));h.info("[数据库进程] 读取到的配置:",s);const o=s.tempPath;h.info("[数据库进程] 正在获取所有图片记录...");const a=this.db.prepare("SELECT type, file_path FROM clipboard_items WHERE type = ?").all("image");h.info("[数据库进程] 开始删除图片文件...");for(const c of a)if(c.file_path)try{E.unlinkSync(c.file_path),h.info(`[数据库进程] 成功删除图片文件: ${c.file_path}`)}catch(l){console.error(`[数据库进程] 删除图片文件失败: ${c.file_path}`,l)}h.info("[数据库进程] 正在清空数据库记录..."),this.db.prepare("DELETE FROM clipboard_items").run(),E.existsSync(o)||(h.info("[数据库进程] 正在创建临时目录..."),E.mkdirSync(o,{recursive:!0,mode:511}),h.info("[数据库进程] 临时目录创建成功")),h.info("[数据库进程] 剪贴板内容和临时文件清理完成"),e()}catch(r){console.error("[数据库进程] 清空剪贴板时发生错误:",r),t(r)}})}toggleTop(e,t){this.db.prepare("UPDATE clipboard_items SET is_topped = ?, top_time = ? WHERE id = ?").run(t?1:0,t?Date.now():null,e)}searchItems(e,t=null){let r="SELECT DISTINCT ci.* FROM clipboard_items ci";const n=[];return t?(r+=" INNER JOIN item_tags it ON ci.id = it.item_id INNER JOIN tags t ON it.tag_id = t.id WHERE t.name = ? AND ci.content LIKE ?",n.push(t,`%${e}%`)):(r+=" WHERE content LIKE ?",n.push(`%${e}%`)),r+=" ORDER BY ci.is_topped DESC, CASE WHEN ci.is_topped = 1 THEN ci.top_time ELSE ci.copy_time END DESC",this.db.prepare(r).all(n)}updateItemTime(e,t){this.db.prepare("UPDATE clipboard_items SET copy_time = ? WHERE id = ?").run(t,e)}addTag(e){this.db.prepare("INSERT INTO tags (name, created_at) VALUES (?, ?)").run(e,Date.now())}deleteTag(e){this.db.prepare("DELETE FROM tags WHERE id = ?").run(e)}getAllTags(){return this.db.prepare("SELECT * FROM tags ORDER BY created_at ASC").all()}addItemTag(e,t){this.db.prepare("INSERT INTO item_tags (item_id, tag_id) VALUES (?, ?)").run(e,t)}removeItemTag(e,t){this.db.prepare("DELETE FROM item_tags WHERE item_id = ? AND tag_id = ?").run(e,t)}getItemTags(e){return this.db.prepare("SELECT t.* FROM tags t INNER JOIN item_tags it ON t.id = it.tag_id WHERE it.item_id = ?").all(e)}bindItemToTag(e,t){const r=this.db.prepare("SELECT id FROM tags WHERE name = ?").get(t);if(!r)throw new Error("标签不存在");if(this.db.prepare("SELECT * FROM item_tags WHERE item_id = ? AND tag_id = ?").get(e,r.id)){h.info("[数据库进程] 标签已绑定");return}this.db.prepare("INSERT OR IGNORE INTO item_tags (item_id, tag_id) VALUES (?, ?)").run(e,r.id)}};f(O,"instance");let D=O,w=u.dirname(k.fileURLToPath(typeof document>"u"?require("url").pathToFileURL(__filename).href:b&&b.tagName.toUpperCase()==="SCRIPT"&&b.src||new URL("main.js",document.baseURI).href));h.info("[主进程] 程序文件夹位置",w);process.env.APP_ROOT=u.join(w,"..");const x=process.env.VITE_DEV_SERVER_URL,Sr=u.join(process.env.APP_ROOT,"dist-electron"),B=u.join(process.env.APP_ROOT,"dist");process.env.VITE_PUBLIC=x?u.join(process.env.APP_ROOT,"public"):B;const de=process.env.NODE_ENV;h.info("[主进程] 运行环境：",process.env.NODE_ENV);de!=="development"&&(w=w.replace("\\app.asar\\dist-electron",""));let d;const ue=vr();function te(){d=new m.BrowserWindow({icon:u.join(process.env.VITE_PUBLIC,"electron-vite.svg"),webPreferences:{nodeIntegration:!0,contextIsolation:!0,preload:u.join(u.dirname(k.fileURLToPath(typeof document>"u"?require("url").pathToFileURL(__filename).href:b&&b.tagName.toUpperCase()==="SCRIPT"&&b.src||new URL("main.js",document.baseURI).href)),"preload.mjs")}});const i=ue.theme||"light";h.info("[主进程] 读取到的主题配置:",i),d.webContents.on("did-finish-load",()=>{d==null||d.webContents.send("main-process-message",new Date().toLocaleString()),h.info("[主进程] 发送主题设置到渲染进程"),d==null||d.webContents.send("change-theme",i),h.info("[主进程] 窗口加载完成，开始监听剪贴板"),H()}),x?d.loadURL(x):d.loadFile(u.join(B,"index.html")),d.webContents.openDevTools({mode:"detach"}),d.on("closed",()=>{C&&(clearTimeout(C),C=null)})}m.ipcMain.handle("get-clipboard-history",async()=>D.getInstance().getAllItems());m.ipcMain.handle("clear-clipboard-history",async()=>(D.getInstance().clearAll(),!0));m.app.on("window-all-closed",()=>{process.platform!=="darwin"&&(m.app.quit(),d=null)});m.app.whenReady().then(()=>{te(),H(),m.app.on("activate",()=>{m.BrowserWindow.getAllWindows().length===0&&te()})});m.app.on("window-all-closed",()=>{process.platform==="darwin"&&(h.info("[主进程] 关闭程序"),m.app.quit())});let re=m.clipboard.readText(),W=m.clipboard.readImage().isEmpty()?null:m.clipboard.readImage().toPNG(),C=null;function H(){if(!d||d.isDestroyed()||!d.webContents||d.webContents.isDestroyed()){h.info("[主进程] 窗口或渲染进程不可用，跳过剪贴板检查");return}try{const i=m.clipboard.readText(),e=m.clipboard.readBuffer("FileNameW"),t=m.clipboard.readImage();if(!t.isEmpty()){const r=t.toPNG();if(W!==null&&Buffer.compare(r,W)!==0){h.info("[主进程] 检测到剪贴板中有图片"),h.info("[主进程] 检测到新的图片内容"),W=r;const s=Date.now(),o=u.join(ue.tempPath||u.join(w,"temp"));let a=null;if(E.existsSync(o)){const l=E.readdirSync(o);for(const p of l)if(p.endsWith(".png")){const g=u.join(o,p),y=E.readFileSync(g);if(Buffer.compare(y,r)===0){a=g;break}}}else E.mkdirSync(o,{recursive:!0});let c;if(a?(c=a,h.info("[主进程] 找到相同内容的图片文件:",c)):(c=u.join(o,`clipboard_${s}.png`),E.writeFileSync(c,r),h.info("[主进程] 图片已保存到临时目录:",c)),d&&!d.isDestroyed()){const l=d.webContents;if(l&&!l.isDestroyed()){if(l.getProcessId()&&!l.isLoading())try{h.info("[主进程] 准备发送图片信息到渲染进程"),d.webContents.send("clipboard-file",{name:u.basename(c),path:c,type:"image",isNewImage:!a}),h.info("[主进程] 图片信息已发送到渲染进程")}catch(p){if(h.error("[主进程] 发送图片信息到渲染进程时出错:",p),!a)try{E.unlinkSync(c)}catch(g){h.error("[主进程] 清理临时文件时出错:",g)}}}else if(!a)try{E.unlinkSync(c)}catch(p){h.error("[主进程] 清理临时文件时出错:",p)}}}}if(i&&i!==re&&(re=i,D.getInstance().addItem(i,"text",null),d&&!d.isDestroyed()))try{const n=d.webContents;n&&!n.isDestroyed()&&n.send("clipboard-updated",i)}catch(n){h.error("[主进程] 发送文本消息时出错:",n)}if(e&&e.length>0)try{const n=e.toString("utf16le").replace(/\x00/g,"").split(`\r
`).filter(Boolean);if(d&&!d.isDestroyed()){const s=d.webContents;s&&!s.isDestroyed()&&n.forEach(o=>{const a=u.basename(o);s.send("clipboard-file",{name:a,path:o,type:"file"})})}}catch(r){h.error("[主进程] 处理剪贴板文件时出错:",r)}}catch(i){h.error("[主进程] 检查剪贴板时出错:",i)}C=setTimeout(H,1e3)}function vr(){let i;de==="development"?i=u.join(w,"../config"):i=u.join(w,"./config"),h.info("[主进程] 配置文件目录:",i);const e=u.join(i,"settings.conf");h.info("[主进程] 配置文件路径:",e);const t=JSON.parse(E.readFileSync(e,"utf8"));return h.info("[主进程] 读取到的配置:",t),t}exports.MAIN_DIST=Sr;exports.RENDERER_DIST=B;exports.VITE_DEV_SERVER_URL=x;
